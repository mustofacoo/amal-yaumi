<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Amal Yaumi - Checklist Harian</title>
    
    <!-- Firebase SDK -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-app-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-firestore-compat.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/firebase/9.23.0/firebase-auth-compat.min.js"></script>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #ff6b35 0%, #f7931e 100%);
            min-height: 100vh;
            padding: 8px;
        }

        @media (min-width: 576px) { body { padding: 12px; } }
        @media (min-width: 768px) { body { padding: 20px; } }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            overflow: hidden;
        }

        @media (min-width: 768px) { .container { border-radius: 15px; } }

        .header {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px;
            text-align: center;
        }

        @media (min-width: 768px) { .header { padding: 30px; } }

        .header h1 {
            font-size: 1.5em;
            margin-bottom: 8px;
            text-shadow: 0 2px 4px rgba(0,0,0,0.3);
        }

        @media (min-width: 576px) { .header h1 { font-size: 1.8em; margin-bottom: 10px; } }
        @media (min-width: 768px) { .header h1 { font-size: 2.5em; } }

        .date-info {
            font-size: 0.95em;
            opacity: 0.9;
        }

        @media (min-width: 576px) { .date-info { font-size: 1.1em; } }

        .status-info {
            background: rgba(255,255,255,0.1);
            padding: 8px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 0.8em;
        }

        @media (min-width: 576px) {
            .status-info { padding: 10px; border-radius: 8px; margin-top: 10px; font-size: 0.9em; }
        }

        .nav-tabs {
            display: flex;
            background: #f8f9fa;
            border-bottom: 2px solid #e9ecef;
            overflow-x: auto;
            scrollbar-width: thin;
        }

        .nav-tabs::-webkit-scrollbar { height: 4px; }
        .nav-tabs::-webkit-scrollbar-thumb { background: #ccc; border-radius: 2px; }

        .nav-tab {
            flex: 1;
            min-width: 100px;
            padding: 10px 8px;
            background: none;
            border: none;
            cursor: pointer;
            font-size: 0.85em;
            font-weight: 600;
            color: #6c757d;
            transition: all 0.3s ease;
            white-space: nowrap;
        }

        @media (min-width: 576px) {
            .nav-tab { min-width: 120px; padding: 12px 12px; font-size: 0.95em; }
        }

        @media (min-width: 768px) {
            .nav-tab { padding: 15px 20px; font-size: 1.1em; }
        }

        .nav-tab.active {
            background: white;
            color: #ff6b35;
            border-bottom: 3px solid #ff6b35;
        }

        .nav-tab:hover { background: #e9ecef; }

        .content { padding: 12px; }
        @media (min-width: 576px) { .content { padding: 20px; } }
        @media (min-width: 768px) { .content { padding: 30px; } }

        .tab-content { display: none; }
        .tab-content.active { display: block; }

        .quick-nav {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 15px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .quick-nav-label {
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 8px;
            font-size: 1em;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        @media (min-width: 576px) { .quick-nav-label { font-size: 1.1em; } }

        .quick-nav select {
            width: 100%;
            padding: 10px 15px;
            border: 2px solid #dee2e6;
            border-radius: 8px;
            background: white;
            font-size: 1em;
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
        }

        @media (min-width: 576px) { .quick-nav select { padding: 12px 15px; } }

        .quick-nav select:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .employee-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (min-width: 576px) { .employee-grid { gap: 15px; } }
        @media (min-width: 768px) {
            .employee-grid { grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; margin-bottom: 30px; }
        }
        @media (min-width: 1200px) {
            .employee-grid { grid-template-columns: repeat(auto-fit, minmax(380px, 1fr)); }
        }

        .employee-card {
            background: white;
            border-radius: 10px;
            padding: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
            border-left: 4px solid #ff6b35;
            scroll-margin-top: 100px;
        }

        @media (min-width: 576px) { .employee-card { padding: 15px; border-radius: 12px; } }
        @media (min-width: 768px) { .employee-card { padding: 20px; } }

        .employee-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }

        .employee-card.highlighted {
            border-left: 6px solid #28a745;
            box-shadow: 0 8px 25px rgba(40, 167, 69, 0.2);
            transform: scale(1.02);
        }

        .employee-name {
            font-size: 1.1em;
            font-weight: bold;
            color: #2c3e50;
            margin-bottom: 12px;
            display: block;
        }

        @media (min-width: 576px) { .employee-name { font-size: 1.2em; margin-bottom: 15px; } }
        @media (min-width: 768px) { .employee-name { font-size: 1.3em; } }

        .checklist-items { display: grid; gap: 6px; }
        @media (min-width: 576px) { .checklist-items { gap: 8px; } }

        .checklist-item {
            display: flex;
            align-items: center;
            padding: 8px;
            background: #fafafa;
            border-radius: 6px;
            border: 1px solid #e9ecef;
            transition: all 0.2s ease;
        }

        @media (min-width: 576px) { .checklist-item { padding: 10px; border-radius: 8px; } }

        .checklist-item:hover {
            border-color: #ff6b35;
            background: white;
        }

        .checklist-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            margin-right: 10px;
            cursor: pointer;
            transform: scale(1.1);
        }

        @media (min-width: 576px) {
            .checklist-item input[type="checkbox"] { width: 18px; height: 18px; margin-right: 12px; }
        }

        .checklist-item label {
            cursor: pointer;
            flex: 1;
            font-weight: 500;
            font-size: 0.9em;
            line-height: 1.3;
        }

        @media (min-width: 576px) { .checklist-item label { font-size: 1em; } }

        .checklist-item.completed {
            background: #fff3e0;
            border-color: #ff6b35;
        }

        .checklist-item.completed label {
            text-decoration: line-through;
            color: #6c757d;
        }

        .summary-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
            margin-bottom: 20px;
        }

        @media (min-width: 480px) { .summary-stats { grid-template-columns: repeat(2, 1fr); gap: 15px; } }
        @media (min-width: 768px) { .summary-stats { grid-template-columns: repeat(4, 1fr); gap: 20px; margin-bottom: 30px; } }

        .stat-card {
            background: linear-gradient(135deg, #2c3e50 0%, #34495e 100%);
            color: white;
            padding: 15px;
            border-radius: 10px;
            text-align: center;
        }

        @media (min-width: 576px) { .stat-card { padding: 20px; border-radius: 12px; } }
        @media (min-width: 768px) { .stat-card { padding: 25px; } }

        .stat-number {
            font-size: 2em;
            font-weight: bold;
            margin-bottom: 4px;
        }

        @media (min-width: 576px) { .stat-number { font-size: 2.2em; margin-bottom: 5px; } }
        @media (min-width: 768px) { .stat-number { font-size: 2.5em; } }

        .stat-label {
            font-size: 0.95em;
            opacity: 0.9;
            line-height: 1.2;
        }

        @media (min-width: 576px) { .stat-label { font-size: 1em; } }
        @media (min-width: 768px) { .stat-label { font-size: 1.1em; } }

        .report-table {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            overflow-x: auto;
        }

        @media (min-width: 576px) { .report-table { border-radius: 12px; } }

        .report-table table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .report-table th {
            background: #2c3e50;
            color: white;
            padding: 8px 6px;
            text-align: left;
            font-weight: 600;
            font-size: 0.8em;
            white-space: nowrap;
        }

        @media (min-width: 576px) { .report-table th { padding: 10px 8px; font-size: 0.85em; } }
        @media (min-width: 768px) { .report-table th { padding: 15px; font-size: 1em; } }

        .report-table td {
            padding: 6px;
            border-bottom: 1px solid #e9ecef;
            font-size: 0.75em;
        }

        @media (min-width: 576px) { .report-table td { padding: 8px; font-size: 0.8em; } }
        @media (min-width: 768px) { .report-table td { padding: 12px 15px; font-size: 1em; } }

        .report-table tr:hover { background: #f8f9fa; }

        .percentage-bar {
            width: 100%;
            height: 15px;
            background: #e9ecef;
            border-radius: 8px;
            overflow: hidden;
            margin-bottom: 3px;
        }

        @media (min-width: 576px) { .percentage-bar { height: 18px; border-radius: 10px; margin-bottom: 4px; } }
        @media (min-width: 768px) { .percentage-bar { height: 20px; } }

        .percentage-fill {
            height: 100%;
            background: linear-gradient(90deg, #ff6b35, #f7931e);
            transition: width 0.3s ease;
        }

        .auto-reset-info {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 12px;
            margin-bottom: 15px;
            display: flex;
            align-items: center;
            font-size: 0.85em;
            line-height: 1.4;
        }

        @media (min-width: 576px) {
            .auto-reset-info { padding: 15px; margin-bottom: 20px; font-size: 0.9em; }
        }

        .auto-reset-info::before {
            content: "‚è∞";
            font-size: 1.3em;
            margin-right: 8px;
            flex-shrink: 0;
        }

        @media (min-width: 576px) { .auto-reset-info::before { font-size: 1.5em; margin-right: 10px; } }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading-spinner.show { display: block; }

        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .error-message.show { display: block; }

        .success-message {
            background: #d1edff;
            color: #0c5460;
            padding: 12px;
            border-radius: 8px;
            margin-bottom: 20px;
            display: none;
        }

        .success-message.show { display: block; }

        .admin-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            margin-bottom: 15px;
        }

        @media (min-width: 576px) { .admin-card { padding: 20px; border-radius: 12px; margin-bottom: 20px; } }

        .admin-input {
            width: 100%;
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            font-size: 0.95em;
            transition: border-color 0.2s ease;
        }

        @media (min-width: 576px) { .admin-input { padding: 10px 15px; border-radius: 8px; font-size: 1em; } }

        .admin-input:focus {
            outline: none;
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }

        .btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.2s ease;
            font-size: 0.9em;
        }

        @media (min-width: 576px) { .btn { padding: 10px 20px; border-radius: 8px; font-size: 1em; } }

        .btn-primary { background: #007bff; color: white; }
        .btn-success { background: #28a745; color: white; }
        .btn-danger { background: #dc3545; color: white; }
        .btn-warning { background: #ffc107; color: #212529; }

        .btn:hover { opacity: 0.9; transform: translateY(-1px); }
        .btn:disabled { opacity: 0.6; cursor: not-allowed; transform: none; }

        .list-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 12px;
            background: white;
            border-radius: 6px;
            border: 1px solid #dee2e6;
            margin-bottom: 6px;
            transition: all 0.2s ease;
        }

        @media (min-width: 576px) { .list-item { padding: 12px 15px; border-radius: 8px; margin-bottom: 8px; } }

        .list-item:hover { border-color: #ff6b35; background: #f8f9fa; }

        .list-item-content { flex: 1; margin-right: 10px; }
        .list-item-name { font-weight: 500; color: #2c3e50; font-size: 0.95em; }
        @media (min-width: 576px) { .list-item-name { font-size: 1em; } }

        .list-item-actions { display: flex; gap: 6px; flex-shrink: 0; }
        @media (min-width: 576px) { .list-item-actions { gap: 8px; } }

        .btn-sm { padding: 4px 8px; font-size: 0.75em; border-radius: 4px; }
        @media (min-width: 576px) { .btn-sm { padding: 6px 10px; font-size: 0.8em; border-radius: 6px; } }

        .edit-input { border: 2px solid #007bff !important; background: #f8f9ff !important; }

        .month-selector-container {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        @media (min-width: 576px) { .month-selector-container { padding: 20px; border-radius: 12px; margin-bottom: 25px; } }

        .month-selector-flex {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        @media (min-width: 576px) { .month-selector-flex { gap: 15px; } }

        .month-selector-label {
            font-weight: 600;
            color: #2c3e50;
            font-size: 1em;
            white-space: nowrap;
        }

        @media (min-width: 576px) { .month-selector-label { font-size: 1.1em; } }

        .month-selector-select {
            padding: 8px 12px;
            border: 2px solid #e9ecef;
            border-radius: 6px;
            background: white;
            font-size: 0.95em;
            font-weight: 500;
            color: #2c3e50;
            cursor: pointer;
            min-width: 180px;
        }

        @media (min-width: 576px) { .month-selector-select { padding: 8px 15px; border-radius: 8px; font-size: 1em; min-width: 200px; } }

        .month-selector-hint {
            font-size: 0.8em;
            color: #6c757d;
            flex-basis: 100%;
            margin-top: 5px;
        }

        @media (min-width: 768px) { .month-selector-hint { flex-basis: auto; margin-top: 0; font-size: 0.9em; } }

        .table-responsive { overflow-x: auto; -webkit-overflow-scrolling: touch; }
        .table-responsive::-webkit-scrollbar { height: 8px; }
        .table-responsive::-webkit-scrollbar-thumb { background: #ccc; border-radius: 4px; }

        .login-container { max-width: 400px; margin: 0 auto; padding: 15px; }
        @media (min-width: 576px) { .login-container { padding: 20px; } }

        .login-title {
            text-align: center;
            margin-bottom: 15px;
            color: #2c3e50;
            font-size: 1.5em;
        }

        @media (min-width: 576px) { .login-title { margin-bottom: 20px; font-size: 1.8em; } }

        .admin-header {
            margin-bottom: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 10px;
        }

        @media (min-width: 576px) { .admin-header { margin-bottom: 20px; } }

        .admin-title { color: #2c3e50; font-size: 1.3em; }
        @media (min-width: 576px) { .admin-title { font-size: 1.5em; } }
        @media (min-width: 768px) { .admin-title { font-size: 1.8em; } }

        .admin-section-title {
            margin-bottom: 15px;
            color: #2c3e50;
            border-bottom: 2px solid #ff6b35;
            padding-bottom: 8px;
            font-size: 1.1em;
        }

        @media (min-width: 576px) { .admin-section-title { margin-bottom: 20px; padding-bottom: 10px; font-size: 1.2em; } }

        .admin-input-group {
            display: flex;
            gap: 8px;
            margin-bottom: 12px;
            flex-wrap: wrap;
        }

        @media (min-width: 576px) { .admin-input-group { gap: 10px; margin-bottom: 15px; } }

        .admin-input-flex { flex: 1; min-width: 200px; }
        .admin-button-nowrap { white-space: nowrap; flex-shrink: 0; }

        .admin-list-container { background: #f8f9fa; padding: 12px; border-radius: 6px; }
        @media (min-width: 576px) { .admin-list-container { padding: 15px; border-radius: 8px; } }

        .admin-list-title { margin-bottom: 8px; color: #2c3e50; font-size: 1em; }
        @media (min-width: 576px) { .admin-list-title { margin-bottom: 10px; font-size: 1.1em; } }

        .admin-instructions {
            background: #e7f3ff;
            border: 1px solid #b8daff;
            border-radius: 6px;
            padding: 12px;
            margin-top: 15px;
        }

        @media (min-width: 576px) { .admin-instructions { border-radius: 8px; padding: 15px; margin-top: 20px; } }

        .admin-instructions h4 { color: #004085; margin-bottom: 8px; font-size: 1em; }
        @media (min-width: 576px) { .admin-instructions h4 { margin-bottom: 10px; font-size: 1.1em; } }

        .admin-instructions ul { color: #004085; line-height: 1.5; padding-left: 20px; }
        @media (min-width: 576px) { .admin-instructions ul { line-height: 1.6; } }

        .admin-instructions li { margin-bottom: 4px; font-size: 0.9em; }
        @media (min-width: 576px) { .admin-instructions li { margin-bottom: 5px; font-size: 1em; } }

        @keyframes highlight {
            0% { background-color: #fff3e0; }
            50% { background-color: #ffecb3; }
            100% { background-color: #fff3e0; }
        }

        .employee-card.highlight-animation { animation: highlight 1s ease-in-out; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Amal Yaumi Kantor Pusat</h1>
            <div class="date-info" id="currentDate"></div>
            <div class="status-info" id="statusInfo"></div>
        </div>

        <div class="nav-tabs" id="navTabs"></div>

        <div class="content">
            <div class="error-message" id="errorMessage"></div>
            <div class="success-message" id="successMessage"></div>
            
            <!-- Checklist Tab -->
            <div id="checklist" class="tab-content"></div>

            <!-- Report Tab -->
            <div id="report" class="tab-content"></div>

            <!-- Login Tab -->
            <div id="login" class="tab-content"></div>

            <!-- Admin Panel Tab -->
            <div id="admin" class="tab-content"></div>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDdCvdJrthzS07BkAQagNAadWvV3PcNnDk",
            authDomain: "amall-yaumi.firebaseapp.com",
            projectId: "amall-yaumi",
            storageBucket: "amall-yaumi.firebasestorage.app",
            messagingSenderId: "743065908741",
            appId: "1:743065908741:web:5551c8cdb47a3edac58e6c"
        };

        // Application Data
        let employees = [
            'Yuni', 'Didik', 'Budi', 'Riris', 'Rico',
            'Syafiq', 'Faruq', 'Maruf', 'Mamduh', 'Rendi',
            'Hammam', 'Sukris', 'Ibad', 'Faisal', 'Naim',
            'Abdullah', 'Pegawai'
        ];

        let checklistItems = [
            'Qiyamul Lail',
            'Shubuh Berjamaah',
            'Sedekah (utamakan shubuh)',
            'Sholat dhuha',
            'Silaturahmi',
            'Doa untuk Ibka',
            'Istighfar & sholawat'
        ];

        // Admin Variables
        let currentUser = null;
        let adminEmployees = [...employees];
        let adminTasks = [...checklistItems];

        // Global variables
        let checklistData = {};
        let unsubscribe = null;
        let isFirebaseConnected = false;
        let lastResetCheck = null;

        // Edit mode tracking
        let editingEmployee = null;
        let editingTask = null;

        // Utility Functions
        function getTodayKey() {
            return new Date().toISOString().split("T")[0];
        }

        function getCurrentMonthKey() {
            const today = new Date();
            return `${today.getFullYear()}-${String(today.getMonth() + 1).padStart(2, '0')}`;
        }

        function getSelectedMonthKey() {
            const selector = document.getElementById('monthSelector');
            return selector ? selector.value : getCurrentMonthKey();
        }

        function getAvailableMonths() {
            const months = [];
            const startDate = new Date('2025-06-01');
            const currentDate = new Date();
            
            while (startDate <= currentDate) {
                const monthKey = `${startDate.getFullYear()}-${String(startDate.getMonth() + 1).padStart(2, '0')}`;
                const monthName = startDate.toLocaleDateString('id-ID', { 
                    year: 'numeric', 
                    month: 'long' 
                });
                months.push({ key: monthKey, name: monthName });
                startDate.setMonth(startDate.getMonth() + 1);
            }
            return months.reverse();
        }

        function populateMonthSelector() {
            const selector = document.getElementById('monthSelector');
            if (!selector) return;
            
            const availableMonths = getAvailableMonths();
            const currentMonthKey = getCurrentMonthKey();
            const currentSelection = selector.value;
            
            selector.innerHTML = '';
            
            if (availableMonths.length === 0) {
                const currentMonth = new Date();
                const fallbackMonth = {
                    key: `${currentMonth.getFullYear()}-${String(currentMonth.getMonth() + 1).padStart(2, '0')}`,
                    name: currentMonth.toLocaleDateString('id-ID', { year: 'numeric', month: 'long' })
                };
                availableMonths.push(fallbackMonth);
            }
            
            availableMonths.forEach(month => {
                const option = document.createElement('option');
                option.value = month.key;
                option.textContent = month.name;
                if ((currentSelection && month.key === currentSelection) || 
                    (!currentSelection && month.key === currentMonthKey)) {
                    option.selected = true;
                }
                selector.appendChild(option);
            });
        }

        function getDaysInMonth(year, month) {
            return new Date(year, month, 0).getDate();
        }

        function updateStatusInfo(message, isError = false) {
            const statusEl = document.getElementById('statusInfo');
            if (statusEl) {
                statusEl.textContent = message;
                statusEl.style.background = isError ? 'rgba(248, 215, 218, 0.9)' : 'rgba(255,255,255,0.1)';
                statusEl.style.color = isError ? '#721c24' : 'white';
            }
        }

        function showMessage(message, isError = false) {
            const errorEl = document.getElementById('errorMessage');
            const successEl = document.getElementById('successMessage');
            if (errorEl && successEl) {
                if (isError) {
                    errorEl.textContent = message;
                    errorEl.classList.add('show');
                    successEl.classList.remove('show');
                    setTimeout(() => errorEl.classList.remove('show'), 5000);
                } else {
                    successEl.textContent = message;
                    successEl.classList.add('show');
                    errorEl.classList.remove('show');
                    setTimeout(() => successEl.classList.remove('show'), 3000);
                }
            }
        }

        function showLoading(show = true) {
            const spinner = document.getElementById('loadingSpinner');
            if (spinner) {
                spinner.classList[show ? 'add' : 'remove']('show');
            }
        }

        // Tab Switching
        function switchTab(tabId) {
            document.querySelectorAll('.nav-tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            const targetTab = document.querySelector(`.nav-tab[onclick="switchTab('${tabId}')"]`);
            const targetContent = document.getElementById(tabId);

            if (!targetTab || !targetContent) {
                console.error(`Tab or content with ID ${tabId} not found`);
                showMessage('‚ö†Ô∏è Tab tidak ditemukan', true);
                switchTab('checklist');
                return;
            }

            if (tabId === 'report' && !currentUser) {
                showMessage('‚ö†Ô∏è Harap login sebagai admin untuk mengakses Rekap Bulanan', true);
                switchTab('login');
                return;
            }

            if (tabId === 'admin' && !currentUser) {
                showMessage('‚ö†Ô∏è Harap login sebagai admin untuk mengakses Admin Panel', true);
                switchTab('login');
                return;
            }

            targetTab.classList.add('active');
            targetContent.classList.add('active');

            if (tabId === 'report') {
                generateReport();
            }
        }

        // Quick Navigation
        function populateEmployeeSelector() {
            const selector = document.getElementById('employeeSelector');
            if (!selector) return;
            
            selector.innerHTML = '<option value="">-- Pilih Pegawai --</option>';
            employees.sort((a, b) => a.localeCompare(b, 'id')).forEach(employee => {
                const option = document.createElement('option');
                option.value = employee;
                option.textContent = employee;
                selector.appendChild(option);
            });
        }

        function navigateToEmployee() {
            const selector = document.getElementById('employeeSelector');
            const selectedEmployee = selector.value;
            
            if (!selectedEmployee) return;
            
            const employeeCards = document.querySelectorAll('.employee-card');
            let targetCard = null;
            
            employeeCards.forEach(card => {
                const nameElement = card.querySelector('.employee-name');
                if (nameElement && nameElement.textContent.includes(selectedEmployee)) {
                    targetCard = card;
                }
            });
            
            if (targetCard) {
                employeeCards.forEach(card => {
                    card.classList.remove('highlighted', 'highlight-animation');
                });
                
                targetCard.scrollIntoView({ behavior: 'smooth', block: 'center' });
                targetCard.classList.add('highlighted', 'highlight-animation');
                
                setTimeout(() => {
                    targetCard.classList.remove('highlight-animation');
                }, 1000);
                
                setTimeout(() => {
                    targetCard.classList.remove('highlighted');
                }, 3000);
            }
            
            selector.selectedIndex = 0;
        }

        // Firebase Functions
        function initializeFirebase() {
            try {
                if (!firebase.apps.length) {
                    firebase.initializeApp(firebaseConfig);
                }
                window.db = firebase.firestore();
                return window.db.enableNetwork().then(() => {
                    isFirebaseConnected = true;
                    updateStatusInfo('üü¢ Firebase terhubung - Data tersinkron real-time');
                    initializeFirebaseListener();
                    loadDynamicData();
                }).catch(error => {
                    console.error('‚ùå Firebase connection failed:', error);
                    isFirebaseConnected = false;
                    updateStatusInfo('üî¥ Firebase error - Mode offline', true);
                    initializeEmptyData();
                    generateEmployeeCards();
                    populateEmployeeSelector();
                });
            } catch (error) {
                console.error('‚ùå Firebase initialization error:', error);
                isFirebaseConnected = false;
                updateStatusInfo('üî¥ Firebase initialization failed - Mode offline', true);
                initializeEmptyData();
                generateEmployeeCards();
                populateEmployeeSelector();
            }
        }

        function initializeEmptyData() {
            checklistData = {};
            employees.forEach(employee => {
                checklistData[employee] = {};
                checklistItems.forEach(item => {
                    checklistData[employee][item] = false;
                });
            });
        }

        function initializeFirebaseListener() {
            if (!window.db || !isFirebaseConnected) {
                showMessage('‚ö†Ô∏è Database tidak tersedia - menggunakan mode offline', true);
                initializeEmptyData();
                generateEmployeeCards();
                return;
            }

            const todayKey = getTodayKey();
            const todayDocRef = window.db.collection("checklist").doc(todayKey);

            showLoading(true);
            initializeEmptyData();

            todayDocRef.get().then(doc => {
                if (!doc.exists) {
                    const initialData = {};
                    employees.forEach(employee => {
                        initialData[employee] = {};
                        checklistItems.forEach(item => {
                            initialData[employee][item] = false;
                        });
                    });
                    return todayDocRef.set(initialData).then(() => {
                        console.log('‚úÖ Created new checklist document for today');
                        showMessage('‚úÖ Checklist hari ini siap digunakan');
                    });
                }
            }).catch(error => {
                console.error("‚ùå Error creating document:", error);
                showMessage("‚ö†Ô∏è Gagal membuat dokumen checklist - menggunakan mode offline", true);
                showLoading(false);
                generateEmployeeCards();
            });

            unsubscribe = todayDocRef.onSnapshot(
                (doc) => {
                    showLoading(false);
                    if (doc.exists) {
                        checklistData = doc.data();
                        console.log('üì° Real-time data updated');
                    } else {
                        initializeEmptyData();
                    }
                    generateEmployeeCards();
                    populateEmployeeSelector();
                },
                (error) => {
                    console.error("‚ùå Error listening to document:", error);
                    showMessage("‚ö†Ô∏è Koneksi real-time terputus - data mungkin tidak tersinkron", true);
                    showLoading(false);
                    initializeEmptyData();
                    generateEmployeeCards();
                    populateEmployeeSelector();
                }
            );
        }

        function updateChecklistItem(employee, item, checked) {
            if (!window.db || !isFirebaseConnected) {
                checklistData[employee][item] = checked;
                generateEmployeeCards();
                showMessage('‚ö†Ô∏è Mode offline - perubahan tidak akan tersinkron', true);
                return;
            }

            const todayKey = getTodayKey();
            const todayDocRef = window.db.collection("checklist").doc(todayKey);

            const updateData = {};
            updateData[`${employee}.${item}`] = checked;

            todayDocRef.update(updateData).then(() => {
                console.log(`‚úÖ Updated ${employee} - ${item}: ${checked}`);
            }).catch(error => {
                console.error("‚ùå Error updating checklist:", error);
                showMessage("‚ö†Ô∏è Gagal menyimpan perubahan - coba lagi", true);
                const checkbox = document.querySelector(`input[data-employee="${employee}"][data-item="${item}"]`);
                if (checkbox) {
                    checkbox.checked = !checked;
                }
            });
        }

        // Report Generation
        async function generateReport() {
            const reportBody = document.getElementById('reportBody');
            const summaryStats = document.getElementById('summaryStats');
            if (!reportBody || !summaryStats) {
                console.error('Report elements not found');
                showMessage('‚ö†Ô∏è Gagal menampilkan rekap bulanan', true);
                return;
            }

            showLoading(true);
            const monthKey = getSelectedMonthKey();
            reportBody.innerHTML = '';
            summaryStats.innerHTML = '';

            try {
                if (!isFirebaseConnected) {
                    showMessage('‚ö†Ô∏è Mode offline - data rekap tidak tersedia', true);
                    showLoading(false);
                    return;
                }

                const year = monthKey.split('-')[0];
                const month = monthKey.split('-')[1];
                const daysInMonth = getDaysInMonth(year, parseInt(month));
                const reportData = {};

                employees.forEach(emp => {
                    reportData[emp] = checklistItems.reduce((acc, item) => {
                        acc[item] = 0;
                        return acc;
                    }, {});
                });

                for (let day = 1; day <= daysInMonth; day++) {
                    const dateKey = `${year}-${month}-${String(day).padStart(2, '0')}`;
                    const docRef = window.db.collection('checklist').doc(dateKey);
                    const doc = await docRef.get();
                    if (doc.exists) {
                        const dailyData = doc.data();
                        employees.forEach(emp => {
                            checklistItems.forEach(item => {
                                if (dailyData[emp]?.[item]) {
                                    reportData[emp][item]++;
                                }
                            });
                        });
                    }
                }

                const totalEmployees = employees.length;
                const stats = checklistItems.map(item => {
                    const completed = employees.reduce((sum, emp) => sum + reportData[emp][item], 0);
                    const percentage = ((completed / (totalEmployees * daysInMonth)) * 100).toFixed(1);
                    return `
                        <div class="stat-card">
                            <div class="stat-number">${percentage}%</div>
                            <div class="stat-label">${item}</div>
                        </div>
                    `;
                });
                summaryStats.innerHTML = stats.join('');

                const rows = employees.map(emp => {
                    const percentages = checklistItems.map(item => {
                        const completion = reportData[emp][item];
                        const percentage = ((completion / daysInMonth) * 100).toFixed(1);
                        return `
                            <td>
                                <div class="percentage-bar">
                                    <div class="percentage-fill" style="width: ${percentage}%"></div>
                                </div>
                                ${percentage}%
                            </td>
                        `;
                    });
                    const average = checklistItems.reduce((sum, item) => sum + (reportData[emp][item] / daysInMonth * 100), 0) / checklistItems.length;
                    return `
                        <tr>
                            <td>${emp}</td>
                            ${percentages.join('')}
                            <td>${average.toFixed(1)}%</td>
                        </tr>
                    `;
                });
                reportBody.innerHTML = rows.join('');

                showLoading(false);
                showMessage('‚úÖ Rekap bulanan berhasil dimuat');
            } catch (error) {
                console.error('Error generating report:', error);
                showMessage('‚ö†Ô∏è Gagal memuat rekap bulanan', true);
                showLoading(false);
            }
        }

        // Admin Authentication
        async function loginAdmin() {
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;
            const messageEl = document.getElementById('loginMessage');

            if (!email || !password) {
                messageEl.innerHTML = '<span style="color: #dc3545;">‚ö†Ô∏è Harap isi email dan password</span>';
                return;
            }

            try {
                messageEl.innerHTML = '<span style="color: #007bff;">üîÑ Memproses login...</span>';
                const userCredential = await firebase.auth().signInWithEmailAndPassword(email, password);
                currentUser = userCredential.user;

                document.getElementById('adminTab').style.display = 'block';
                document.getElementById('reportTab').style.display = 'block';
                document.getElementById('loginTab').style.display = 'none';

                loadAdminData();
                switchTab('admin');
                showMessage('‚úÖ Login berhasil! Selamat datang Admin');
            } catch (error) {
                console.error('Login error:', error);
                let errorMessage = '‚ùå Login gagal';
                if (error.code === 'auth/user-not-found') {
                    errorMessage = '‚ùå Email tidak terdaftar';
                } else if (error.code === 'auth/wrong-password') {
                    errorMessage = '‚ùå Password salah';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage = '‚ùå Format email tidak valid';
                } else if (error.code === 'auth/network-request-failed') {
                    errorMessage = '‚ùå Tidak ada koneksi internet';
                }
                messageEl.innerHTML = `<span style="color: #dc3545;">${errorMessage}</span>`;
            }
        }

        function logoutAdmin() {
            firebase.auth().signOut().then(() => {
                currentUser = null;
                editingEmployee = null;
                editingTask = null;

                document.getElementById('adminTab').style.display = 'none';
                document.getElementById('reportTab').style.display = 'none';
                document.getElementById('loginTab').style.display = 'block';

                switchTab('checklist');
                showMessage('üëã Logout berhasil');

                document.getElementById('adminEmail').value = '';
                document.getElementById('adminPassword').value = '';
                document.getElementById('loginMessage').innerHTML = '';
            });
        }

        // Admin Data Management
        async function loadAdminData() {
            try {
                const employeesDoc = await window.db.collection('config').doc('employees').get();
                if (employeesDoc.exists) {
                    adminEmployees = employeesDoc.data().list || [...employees];
                } else {
                    adminEmployees = [...employees];
                }

                const tasksDoc = await window.db.collection('config').doc('tasks').get();
                if (tasksDoc.exists) {
                    adminTasks = tasksDoc.data().list || [...checklistItems];
                } else {
                    adminTasks = [...checklistItems];
                }

                employees = [...adminEmployees];
                checklistItems = [...adminTasks];
                initializeEmptyData();
                generateEmployeeCards();
                populateEmployeeSelector();
                updateAdminUI();
            } catch (error) {
                console.error('Error loading admin data:', error);
                adminEmployees = [...employees];
                adminTasks = [...checklistItems];
                updateAdminUI();
                showMessage('‚ö†Ô∏è Menggunakan data default - Firebase tidak tersedia', true);
            }
        }

        async function loadDynamicData() {
            try {
                const employeesDoc = await window.db.collection('config').doc('employees').get();
                if (employeesDoc.exists) {
                    const dynamicEmployees = employeesDoc.data().list;
                    if (dynamicEmployees && dynamicEmployees.length > 0) {
                        employees.length = 0;
                        employees.push(...dynamicEmployees);
                    }
                }

                const tasksDoc = await window.db.collection('config').doc('tasks').get();
                if (tasksDoc.exists) {
                    const dynamicTasks = tasksDoc.data().list;
                    if (dynamicTasks && dynamicTasks.length > 0) {
                        checklistItems.length = 0;
                        checklistItems.push(...dynamicTasks);
                    }
                }

                initializeEmptyData();
                generateEmployeeCards();
                populateEmployeeSelector();
            } catch (error) {
                console.error('Error loading dynamic data:', error);
                showMessage('‚ö†Ô∏è Gagal memuat konfigurasi - menggunakan data default', true);
            }
        }

        async function saveEmployeesToFirebase() {
            try {
                if (!window.db || !isFirebaseConnected) {
                    console.log('‚ö†Ô∏è Firebase not available, saving locally only');
                    return true;
                }
                await window.db.collection('config').doc('employees').set({
                    list: adminEmployees,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('‚úÖ Employees saved to Firebase');
                return true;
            } catch (error) {
                console.error('Error saving employees:', error);
                showMessage('‚ö†Ô∏è Data tersimpan lokal - akan disinkron saat online', true);
                return true;
            }
        }

        async function saveTasksToFirebase() {
            try {
                if (!window.db || !isFirebaseConnected) {
                    console.log('‚ö†Ô∏è Firebase not available, saving locally only');
                    return true;
                }
                await window.db.collection('config').doc('tasks').set({
                    list: adminTasks,
                    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
                });
                console.log('‚úÖ Tasks saved to Firebase');
                return true;
            } catch (error) {
                console.error('Error saving tasks:', error);
                showMessage('‚ö†Ô∏è Data tersimpan lokal - akan disinkron saat online', true);
                return true;
            }
        }

        // Employee Management
        async function addEmployee() {
            const input = document.getElementById('newEmployeeName');
            const name = input.value.trim();
            
            if (!name) {
                showMessage('‚ö†Ô∏è Nama pegawai tidak boleh kosong', true);
                return;
            }
            
            if (adminEmployees.includes(name)) {
                showMessage('‚ö†Ô∏è Pegawai sudah ada dalam daftar', true);
                return;
            }
            
            adminEmployees.push(name);
            updateAdminUI();
            saveEmployeesToFirebase();
            input.value = '';
            
            if (!employees.includes(name)) {
                employees.push(name);
                initializeEmptyData();
                generateEmployeeCards();
                populateEmployeeSelector();
            }
            
            showMessage(`‚úÖ Pegawai "${name}" berhasil ditambahkan`);
        }

        function editEmployee(oldName) {
            if (editingEmployee) {
                showMessage('‚ö†Ô∏è Selesaikan edit yang sedang berlangsung terlebih dahulu', true);
                return;
            }
            
            editingEmployee = oldName;
            updateEmployeeList();
            
            setTimeout(() => {
                const input = document.querySelector(`input[data-edit-employee="${oldName}"]`);
                if (input) {
                    input.focus();
                    input.select();
                }
            }, 100);
        }

        async function saveEmployeeEdit(oldName) {
            const input = document.querySelector(`input[data-edit-employee="${oldName}"]`);
            if (!input) return;
            
            const newName = input.value.trim();
            
            if (!newName) {
                showMessage('‚ö†Ô∏è Nama pegawai tidak boleh kosong', true);
                return;
            }
            
            if (newName === oldName) {
                editingEmployee = null;
                updateEmployeeList();
                return;
            }
            
            if (adminEmployees.includes(newName)) {
                showMessage('‚ö†Ô∏è Nama pegawai sudah ada dalam daftar', true);
                return;
            }
            
            const index = adminEmployees.indexOf(oldName);
            if (index > -1) {
                adminEmployees[index] = newName;
                editingEmployee = null;
                updateAdminUI();
                saveEmployeesToFirebase();
                
                const mainIndex = employees.indexOf(oldName);
                if (mainIndex > -1) {
                    employees[mainIndex] = newName;
                    initializeEmptyData();
                    generateEmployeeCards();
                    populateEmployeeSelector();
                }
                
                showMessage(`‚úÖ Nama pegawai berhasil diubah dari "${oldName}" ke "${newName}"`);
            }
        }

        function cancelEmployeeEdit() {
            editingEmployee = null;
            updateEmployeeList();
        }

        async function removeEmployee(name) {
            if (confirm(`‚ö†Ô∏è Yakin ingin menghapus pegawai "${name}"?\n\nSemua data checklist pegawai ini akan hilang!`)) {
                adminEmployees = adminEmployees.filter(emp => emp !== name);
                editingEmployee = null;
                updateAdminUI();
                saveEmployeesToFirebase();
                
                const index = employees.indexOf(name);
                if (index > -1) {
                    employees.splice(index, 1);
                    initializeEmptyData();
                    generateEmployeeCards();
                    populateEmployeeSelector();
                }
                
                showMessage(`üóëÔ∏è Pegawai "${name}" berhasil dihapus`);
            }
        }

        // Task Management
        async function addTask() {
            const input = document.getElementById('newTaskName');
            const task = input.value.trim();
            
            if (!task) {
                showMessage('‚ö†Ô∏è Nama tugas tidak boleh kosong', true);
                return;
            }
            
            if (adminTasks.includes(task)) {
                showMessage('‚ö†Ô∏è Tugas sudah ada dalam daftar', true);
                return;
            }
            
            adminTasks.push(task);
            updateAdminUI();
            saveTasksToFirebase();
            input.value = '';
            
            if (!checklistItems.includes(task)) {
                checklistItems.push(task);
                initializeEmptyData();
                generateEmployeeCards();
            }
            
            showMessage(`‚úÖ Tugas "${task}" berhasil ditambahkan`);
        }

        function editTask(oldTask) {
            if (editingTask) {
                showMessage('‚ö†Ô∏è Selesaikan edit yang sedang berlangsung terlebih dahulu', true);
                return;
            }
            
            editingTask = oldTask;
            updateTaskList();
            
            setTimeout(() => {
                const input = document.querySelector(`input[data-edit-task="${oldTask}"]`);
                if (input) {
                    input.focus();
                    input.select();
                }
            }, 100);
        }

        async function saveTaskEdit(oldTask) {
            const input = document.querySelector(`input[data-edit-task="${oldTask}"]`);
            if (!input) return;
            
            const newTask = input.value.trim();
            
            if (!newTask) {
                showMessage('‚ö†Ô∏è Nama tugas tidak boleh kosong', true);
                return;
            }
            
            if (newTask === oldTask) {
                editingTask = null;
                updateTaskList();
                return;
            }
            
            if (adminTasks.includes(newTask)) {
                showMessage('‚ö†Ô∏è Nama tugas sudah ada dalam daftar', true);
                return;
            }
            
            const index = adminTasks.indexOf(oldTask);
            if (index > -1) {
                adminTasks[index] = newTask;
                editingTask = null;
                updateAdminUI();
                saveTasksToFirebase();
                
                const mainIndex = checklistItems.indexOf(oldTask);
                if (mainIndex > -1) {
                    checklistItems[mainIndex] = newTask;
                    initializeEmptyData();
                    generateEmployeeCards();
                }
                
                showMessage(`‚úÖ Nama tugas berhasil diubah dari "${oldTask}" ke "${newTask}"`);
            }
        }

        function cancelTaskEdit() {
            editingTask = null;
            updateTaskList();
        }

        async function removeTask(task) {
            if (confirm(`‚ö†Ô∏è Yakin ingin menghapus tugas "${task}"?\n\nSemua data checklist untuk tugas ini akan hilang!`)) {
                adminTasks = adminTasks.filter(t => t !== task);
                editingTask = null;
                updateAdminUI();
                saveTasksToFirebase();
                
                const index = checklistItems.indexOf(task);
                if (index > -1) {
                    checklistItems.splice(index, 1);
                    initializeEmptyData();
                    generateEmployeeCards();
                }
                
                showMessage(`üóëÔ∏è Tugas "${task}" berhasil dihapus`);
            }
        }

        // UI Updates
        function updateAdminUI() {
            updateEmployeeList();
            updateTaskList();
        }

        function updateEmployeeList() {
            const container = document.getElementById('employeeList');
            if (!container) return;
            
            if (adminEmployees.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Belum ada pegawai</p>';
                return;
            }
            
            container.innerHTML = adminEmployees.map(employee => {
                if (editingEmployee === employee) {
                    return `
                        <div class="list-item">
                            <div class="list-item-content">
                                <input type="text" value="${employee}" class="admin-input edit-input" 
                                       data-edit-employee="${employee}" style="margin: 0;">
                            </div>
                            <div class="list-item-actions">
                                <button onclick="saveEmployeeEdit('${employee}')" class="btn btn-success btn-sm">üíæ Simpan</button>
                                <button onclick="cancelEmployeeEdit()" class="btn btn-warning btn-sm">‚ùå Batal</button>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="list-item">
                            <div class="list-item-content">
                                <span class="list-item-name">üë§ ${employee}</span>
                            </div>
                            <div class="list-item-actions">
                                <button onclick="editEmployee('${employee}')" class="btn btn-warning btn-sm">‚úèÔ∏è Edit</button>
                                <button onclick="removeEmployee('${employee}')" class="btn btn-danger btn-sm">üóëÔ∏è Hapus</button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        function updateTaskList() {
            const container = document.getElementById('taskList');
            if (!container) return;
            
            if (adminTasks.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #6c757d; padding: 20px;">Belum ada tugas</p>';
                return;
            }
            
            container.innerHTML = adminTasks.map(task => {
                if (editingTask === task) {
                    return `
                        <div class="list-item">
                            <div class="list-item-content">
                                <input type="text" value="${task}" class="admin-input edit-input" 
                                       data-edit-task="${task}" style="margin: 0;">
                            </div>
                            <div class="list-item-actions">
                                <button onclick="saveTaskEdit('${task}')" class="btn btn-success btn-sm">üíæ Simpan</button>
                                <button onclick="cancelTaskEdit()" class="btn btn-warning btn-sm">‚ùå Batal</button>
                            </div>
                        </div>
                    `;
                } else {
                    return `
                        <div class="list-item">
                            <div class="list-item-content">
                                <span class="list-item-name">‚úÖ ${task}</span>
                            </div>
                            <div class="list-item-actions">
                                <button onclick="editTask('${task}')" class="btn btn-warning btn-sm">‚úèÔ∏è Edit</button>
                                <button onclick="removeTask('${task}')" class="btn btn-danger btn-sm">üóëÔ∏è Hapus</button>
                            </div>
                        </div>
                    `;
                }
            }).join('');
        }

        // Daily Reset
        function setupDailyReset() {
            lastResetCheck = getTodayKey();
            scheduleNextMidnightReset();
            
            setInterval(() => {
                const currentDate = getTodayKey();
                if (lastResetCheck && lastResetCheck !== currentDate) {
                    console.log('üîÑ Date changed detected, reinitializing checklist');
                    performDailyReset();
                }
                lastResetCheck = currentDate;
            }, 60000);
        }

        function scheduleNextMidnightReset() {
            const now = new Date();
            const tomorrow = new Date(now);
            tomorrow.setDate(tomorrow.getDate() + 1);
            tomorrow.setHours(0, 0, 0, 0);
            
            const timeUntilMidnight = tomorrow.getTime() - now.getTime();
            setTimeout(() => {
                console.log('üåô Midnight reset triggered');
                performDailyReset();
                scheduleNextMidnightReset();
            }, timeUntilMidnight);
        }

        function performDailyReset() {
            if (unsubscribe) {
                unsubscribe();
            }
            if (isFirebaseConnected) {
                initializeFirebaseListener();
            } else {
                initializeEmptyData();
                generateEmployeeCards();
            }
        }

        // Generate Employee Cards
        function generateEmployeeCards() {
            const grid = document.getElementById('employeeGrid');
            if (!grid) {
                console.error('Employee grid element not found');
                showMessage('‚ö†Ô∏è Gagal menampilkan daftar checklist', true);
                return;
            }

            grid.innerHTML = '';
            employees.forEach(employee => {
                const employeeData = checklistData[employee] || {};

                const card = document.createElement('div');
                card.className = 'employee-card';
                card.id = `employee-${employee}`;
                card.innerHTML = `
                    <div class="employee-name">üë§ ${employee}</div>
                    <div class="checklist-items">
                        ${checklistItems.map(item => `
                            <div class="checklist-item ${employeeData[item] ? 'completed' : ''}">
                                <input type="checkbox" 
                                       data-employee="${employee}" 
                                       data-item="${item}" 
                                       ${employeeData[item] ? 'checked' : ''} 
                                       onchange="updateChecklistItem('${employee}', '${item}', this.checked)">
                                <label>${item}</label>
                            </div>
                        `).join('')}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // Initialize UI
        function initializeUI() {
            // Initialize Nav Tabs
            const navTabs = document.getElementById('navTabs');
            navTabs.innerHTML = `
                <button class="nav-tab active" id="checklistTab" onclick="switchTab('checklist')">Checklist Harian</button>
                <button class="nav-tab" id="reportTab" onclick="switchTab('report')" style="display: none;">Rekap Bulanan</button>
                <button class="nav-tab" id="adminTab" onclick="switchTab('admin')" style="display: none;">Admin Panel</button>
                <button class="nav-tab" id="loginTab" onclick="switchTab('login')">Login Admin</button>
            `;

            // Initialize Checklist Tab
            const checklistTab = document.getElementById('checklist');
            checklistTab.innerHTML = `
                <div class="auto-reset-info">
                    <span>Rasulullah dawuh, "Amal yang paling Allah cintai adalah yang berkelanjutan sekalipun jumlahnya sedikit"</span>
                </div>
                <div class="quick-nav">
                    <div class="quick-nav-label">üîç Cari nama dengan cepat</div>
                    <select id="employeeSelector" onchange="navigateToEmployee()">
                        <option value="">-- Pilih Pegawai --</option>
                    </select>
                </div>
                <div class="loading-spinner" id="loadingSpinner">
                    <div>Memuat data...</div>
                </div>
                <div class="employee-grid" id="employeeGrid"></div>
            `;

            // Initialize Report Tab
            const reportTab = document.getElementById('report');
            reportTab.innerHTML = `
                <div class="month-selector-container">
                    <div class="month-selector-flex">
                        <label for="monthSelector" class="month-selector-label">üìÖ Pilih Bulan Rekap:</label>
                        <select id="monthSelector" onchange="generateReport()" class="month-selector-select"></select>
                        <div class="month-selector-hint">
                            <small>üí° Bulan baru akan otomatis ditambahkan setiap pergantian bulan</small>
                        </div>
                    </div>
                </div>
                <div class="summary-stats" id="summaryStats"></div>
                <div class="table-responsive">
                    <div class="report-table">
                        <table id="reportTable">
                            <thead>
                                <tr>
                                    <th>Nama Pegawai</th>
                                    <th>Qiyamul Lail</th>
                                    <th>Shubuh berjamaah</th>
                                    <th>Sedekah</th>
                                    <th>Sholat Dhuha</th>
                                    <th>Silaturahim</th>
                                    <th>Doa untuk Ibka</th>
                                    <th>Istighfar & Sholawat</th>
                                    <th>Rata‚Äërata</th>
                                </tr>
                            </thead>
                            <tbody id="reportBody"></tbody>
                        </table>
                    </div>
                </div>
            `;

            // Initialize Login Tab
            const loginTab = document.getElementById('login');
            loginTab.innerHTML = `
                <div class="login-container">
                    <h2 class="login-title">üîê Login Admin</h2>
                    <div class="admin-card">
                        <div style="margin-bottom: 15px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Email Admin:</label>
                            <input type="email" id="adminEmail" class="admin-input" placeholder="admin@amalyaumi.com">
                        </div>
                        <div style="margin-bottom: 20px;">
                            <label style="display: block; margin-bottom: 5px; font-weight: 600;">Password:</label>
                            <input type="password" id="adminPassword" class="admin-input" placeholder="Masukkan password">
                        </div>
                        <button onclick="loginAdmin()" class="btn btn-primary" style="width: 100%; padding: 12px;">
                            üöÄ Login Admin
                        </button>
                        <div id="loginMessage" style="margin-top: 15px; text-align: center;"></div>
                    </div>
                    <div style="text-align: center; margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                        <small style="color: #6c757d;">
                            üí° <strong>Petunjuk:</strong> Hanya admin yang memiliki akses untuk mengelola data pegawai dan tugas harian.
                        </small>
                    </div>
                </div>
            `;

            // Initialize Admin Tab
            const adminTab = document.getElementById('admin');
            adminTab.innerHTML = `
                <div class="admin-header">
                    <h2 class="admin-title">‚öôÔ∏è Admin Panel</h2>
                    <button onclick="logoutAdmin()" class="btn btn-danger">üö™ Logout</button>
                </div>
                <div class="admin-card">
                    <h3 class="admin-section-title">üßë‚Äçüíº Kelola Pegawai</h3>
                    <div class="admin-input-group">
                        <input type="text" id="newEmployeeName" placeholder="Nama pegawai baru (contoh: Ahmad)" 
                               class="admin-input admin-input-flex">
                        <button onclick="addEmployee()" class="btn btn-success admin-button-nowrap">‚ûï Tambah Pegawai</button>
                    </div>
                    <div class="admin-list-container">
                        <h4 class="admin-list-title">üìã Daftar Pegawai Saat Ini:</h4>
                        <div id="employeeList" style="display: grid; gap: 8px;"></div>
                    </div>
                </div>
                <div class="admin-card">
                    <h3 class="admin-section-title" style="border-bottom-color: #007bff;">üìã Kelola Tugas Harian</h3>
                    <div class="admin-input-group">
                        <input type="text" id="newTaskName" placeholder="Tugas baru (contoh: Sholat Maghrib)" 
                               class="admin-input admin-input-flex">
                        <button onclick="addTask()" class="btn btn-primary admin-button-nowrap">‚ûï Tambah Tugas</button>
                    </div>
                    <div class="admin-list-container">
                        <h4 class="admin-list-title">‚úÖ Daftar Tugas Saat Ini:</h4>
                        <div id="taskList" style="display: grid; gap: 8px;"></div>
                    </div>
                </div>
                <div class="admin-instructions">
                    <h4>üìñ Petunjuk Penggunaan Admin:</h4>
                    <ul>
                        <li><strong>Menambah Pegawai:</strong> Ketik nama pegawai baru dan klik "Tambah Pegawai"</li>
                        <li><strong>Mengedit Pegawai:</strong> Klik tombol "Edit" di samping nama pegawai, ubah nama, lalu klik "Simpan"</li>
                        <li><strong>Menghapus Pegawai:</strong> Klik tombol "Hapus" di samping nama pegawai</li>
                        <li><strong>Menambah Tugas:</strong> Ketik nama tugas baru dan klik "Tambah Tugas"</li>
                        <li><strong>Mengedit Tugas:</strong> Klik tombol "Edit" di samping nama tugas, ubah nama, lalu klik "Simpan"</li>
                        <li><strong>Menghapus Tugas:</strong> Klik tombol "Hapus" di samping nama tugas</li>
                        <li><strong>‚ö†Ô∏è Peringatan:</strong> Menghapus pegawai atau tugas akan menghilangkan semua data checklist terkait</li>
                    </ul>
                </div>
            `;
        }

        // Initialize App
        function initializeApp() {
            const dateEl = document.getElementById('currentDate');
            if (dateEl) {
                dateEl.textContent = new Date().toLocaleDateString('id-ID', {
                    weekday: 'long',
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric'
                });
            }

            updateStatusInfo('üîÑ Memuat aplikasi...');
            initializeUI();
            initializeFirebase();
            switchTab('checklist');
            populateEmployeeSelector();
            setupDailyReset();
            populateMonthSelector();
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
